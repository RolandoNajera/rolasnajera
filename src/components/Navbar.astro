---
import site from "../site.config.json";
import { Icon } from "astro-icon/components";
const social = site.social || {};
---
<header class="fixed inset-x-0 top-0 z-50">
  <div id="navbar" class="transition-colors duration-300">
    <div class="container-base flex h-20 items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="Ir al inicio">
        <img
          src="/images/RolasFinanzas_1.png"
          alt="Rolas Najera logo"
          width="120"
          height="36"
          class="h-8 w-auto md:h-9"
          loading="eager"
          decoding="async"
        />
        <span class="sr-only">Rolas Najera</span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
        <a href="https://substack.com/@rolasnajera" target="_blank" class="nav-link">Blog</a>
        <div class="ml-2 flex items-center gap-3">
          <a href={social.instagram} target="_blank" rel="noopener" aria-label="Instagram" class="hover:opacity-80">
            <Icon name="mdi:instagram" class="h-5 w-5 text-gray-700 dark:text-gray-200" />
          </a>
          <a href={social.linkedin} target="_blank" rel="noopener" aria-label="LinkedIn" class="hover:opacity-80">
            <Icon name="mdi:linkedin" class="h-5 w-5 text-gray-700 dark:text-gray-200" />
          </a>
          <button id="theme-toggle" class="ml-2 rounded p-1.5 hover:bg-gray-100 dark:hover:bg-gray-800" aria-label="Cambiar tema">
            <Icon name="tabler:sun" class="h-5 w-5 hidden dark:inline text-amber-300" />
            <Icon name="tabler:moon" class="h-5 w-5 dark:hidden text-gray-700" />
          </button>
        </div>
      </nav>

      <button id="menu-open" class="md:hidden rounded p-2 hover:bg-gray-100 dark:hover:bg-gray-800" aria-label="Abrir menú">
        <Icon name="tabler:menu-2" class="h-6 w-6" />
      </button>
    </div>
  </div>

  <!-- Mobile Drawer -->
  <div id="mobile-overlay" class="fixed inset-0 z-40 hidden bg-black/30"></div>
  <aside id="mobile-drawer" class="fixed left-0 top-0 z-50 h-full w-72 -translate-x-full transform bg-white dark:bg-gray-900 shadow-xl transition-transform duration-300">
    <div class="flex h-20 items-center justify-between px-4">
      <a href="/" class="flex items-center gap-3" aria-label="Ir al inicio" on:click="closeMenu()">
        <img src="/images/RolasFinanzas_1.png" alt="Rolas Najera logo" width="120" height="36" class="h-8 w-auto" loading="eager" decoding="async" />
      </a>
      <button id="menu-close" class="rounded p-2 hover:bg-gray-100 dark:hover:bg-gray-800" aria-label="Cerrar menú">
        <Icon name="tabler:x" class="h-6 w-6" />
      </button>
    </div>
    <nav class="px-4 pb-8">
      <a href="https://substack.com/@rolasnajera" target="_blank" class="block rounded px-3 py-2 text-base font-medium hover:bg-gray-100 dark:hover:bg-gray-800" on:click="closeMenu()">Blog</a>
      <div class="mt-4 flex items-center gap-4 px-1">
        <a href={social.instagram} target="_blank" rel="noopener" aria-label="Instagram" class="rounded p-2 hover:bg-gray-100 dark:hover:bg-gray-800">
          <Icon name="mdi:instagram" class="h-5 w-5" />
        </a>
        <a href={social.linkedin} target="_blank" rel="noopener" aria-label="LinkedIn" class="rounded p-2 hover:bg-gray-100 dark:hover:bg-gray-800">
          <Icon name="mdi:linkedin" class="h-5 w-5" />
        </a>
        <button id="theme-toggle-mobile" class="ml-auto rounded p-2 hover:bg-gray-100 dark:hover:bg-gray-800" aria-label="Cambiar tema">
          <Icon name="tabler:sun" class="h-5 w-5 hidden dark:inline text-amber-300" />
          <Icon name="tabler:moon" class="h-5 w-5 dark:hidden" />
        </button>
      </div>
    </nav>
  </aside>
</header>

<style>
  .nav-link { @apply text-gray-700 hover:text-gray-900 dark:text-gray-200 dark:hover:text-white; }
  #navbar {
    /* Start transparent over hero */
    background-color: transparent;
  }
  .navbar-solid {
    /* Solid after scrolling */
    @apply bg-white/90 dark:bg-gray-950/80 backdrop-blur border-b border-gray-200/70 dark:border-gray-800;
  }
</style>

<script>
  const root = document.documentElement;
  const navbar = document.getElementById('navbar');
  const openBtn = document.getElementById('menu-open');
  const closeBtn = document.getElementById('menu-close');
  const overlay = document.getElementById('mobile-overlay');
  const drawer = document.getElementById('mobile-drawer');
  const toggleBtns = [document.getElementById('theme-toggle'), document.getElementById('theme-toggle-mobile')].filter(Boolean);

  const applyNavbarStyle = () => {
    const solid = window.scrollY > 10;
    if (solid) navbar.classList.add('navbar-solid');
    else navbar.classList.remove('navbar-solid');
  };
  addEventListener('scroll', applyNavbarStyle, { passive: true });
  addEventListener('load', applyNavbarStyle);

  const openMenu = () => {
    drawer.classList.remove('-translate-x-full');
    overlay.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  };
  const closeMenu = () => {
    drawer.classList.add('-translate-x-full');
    overlay.classList.add('hidden');
    document.body.style.overflow = '';
  };
  openBtn?.addEventListener('click', openMenu);
  closeBtn?.addEventListener('click', closeMenu);
  overlay?.addEventListener('click', closeMenu);

  const toggleTheme = () => {
    const isDark = root.classList.toggle('dark');
    try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch (e) {}
  };
  toggleBtns.forEach(btn => btn?.addEventListener('click', toggleTheme));
</script>
